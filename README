screen-session - GNU Screen session saver
=========================================

Website: http://adb.cba.pl

Repository: http://github.com/skoneka/screen-session

Howto: http://adb.cba.pl/gnu-screen-tips-page-my.html#howto-screen-session

-----------------------------------------------------------------------
Description
-----------------------------------------------------------------------
screen-session is a GNU Screen session saver.

screen-session currently supports saving of:
groups and basic windows, directories, programs, layouts, scrollbacks,
titles. It recognizes groups and regular windows. Currently there is no
support for serial and telnet window types (because so far I didn't
manage to use them) but they would be probably easy to add.

screen-session saves directories and programs by directly reading /proc 
filesystem  ( it reads cwd, exe and cmdline ) and sorts them by parent
pid. There is no "stuffing" and there is totally no interaction with 
programs in windows.

After session loading, in every new window starts screen-session-primer 
(small C program) which displays list of processes and asks user what 
to do (whether to start none, part of or all window's processes).
Then, primer tries to restore the string of processes by execing
'program -c "/command/;program" arguments' for nodes and simply
'program arguments' for leafs. Entire string of processes can only be
properly restored if every non-leaf accepts '-c command' switch.

Can be restored completly:
0 zsh -> 1 bash -> 2 vim hello.c 

Only up to 1:
0 zsh -> 1 man hello -> 2 less


There is also a blacklist for programs which may not be started
(file $HOME./screen-sessions/BLACKLIST).
 
screen-session-primer uses linux color escapes. If you dont want color
remove "-DCOLOR" from config.mk

Normally screen-session does not restore exact window numbers. If you 
want to force verbatim restoring use --exact flag.

Savefiles are .tar.bz2 archives. Scrollbacks can take 
a *lot* of space. During reading temporary files are stored in 
/tmp/screen-session-$USER.


-----------------------------------------------------------------------
Requirements
-----------------------------------------------------------------------
Requires a recent version of Screen patched with screen-session.diff
Depends on "lsof", "tar", "grep" and reads /proc filesystem.


screen-session.diff changes:
- add "tty" command
- make "layout" and "group" and "maxwin" and "sessionname" queryable


-----------------------------------------------------------------------
Installation
-----------------------------------------------------------------------
Edit config.mk to match your local setup (screen-session is installed 
into the /usr/local namespace by default), you can also disable colors 
by removing "-DCOLOR".


Afterwards enter the following command to build and install 
screen-session (if necessary as root):

    make clean install


Make sure you have a recent version of Screen and apply necessary patch:

    git clone git://git.sv.gnu.org/screen.git screen; cd screen
    
    git-apply ../screen-session-${VERSION}/screen-session.diff

    cd src; autoreconf; autoheader; ./configure && make

    sudo make install


-----------------------------------------------------------------------
Running screen-session
-----------------------------------------------------------------------
Saving:
    # save inside saved session 
    screen-session --save --force
    
    # save inside saved session specifing --maxwin
    screen-session --save --maxwin {biggest window number}
    
    # save inside saved session without layouts
    screen-session --save --layout 

    # save saving session with PID in mysavedsession folder
    screen-session --save --in PID --out mysavedsession


Loading:
    # load last saved session inside target session
    screen-session --load
    
    # load last saved session with exactly the same window numbers 
    screen-session --load --exact --maxwin {biggest window number}
    
    # load last saved session inside target session without layouts
    screen-session --load --layout

    # load session from savefile loaded to Screen with PID
    screen-session --load --in mysavedsession --out PID


Example bindings:
    # start screen-session in new window logging output and quickly 
    # return to previous window
    bind S eval "screen sh -c 'sleep 1; screen-session --save --force --log /tmp/screen-session-log'" "other"


-----------------------------------------------------------------------
Bugs
-----------------------------------------------------------------------
There are no bugs, only features.

- Do not try to save/load a completly detached session with enabled 
  layouts in screen-session because Screen will crash.
  Disable layouts saving/loading with --no-layout flag.

Send suggestions to admin<[at]>adb.cba.pl

